# Jolt GraphQL API Schema
# Combined schema for backend server

# Custom scalar types
scalar DateTime
scalar UUID

# Pagination input
input PaginationInput {
  first: Int
  after: String
  last: Int
  before: String
}

# Page info for cursor-based pagination
type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

# User types
type User {
  id: UUID!
  email: String!
  displayName: String!
  avatarUrl: String
  timezone: String!
  isPremium: Boolean!
  premiumUntil: DateTime
  createdAt: DateTime!
  updatedAt: DateTime!
}

type AuthPayload {
  accessToken: String!
  refreshToken: String!
  expiresIn: Int!
  user: User!
}

# Device types
enum Platform {
  IOS
  ANDROID
}

type Device {
  id: UUID!
  platform: Platform!
  deviceIdentifier: String!
  pushToken: String!
  deviceName: String
  appVersion: String
  osVersion: String
  lastSeenAt: DateTime!
  createdAt: DateTime!
}

input RegisterDeviceInput {
  platform: Platform!
  deviceIdentifier: String!
  pushToken: String!
  deviceName: String
  appVersion: String
  osVersion: String
}

# NotificationSound types
type NotificationSound {
  id: UUID!
  name: String!
  filename: String!
  isFree: Boolean!
}

# ReminderList types
type ReminderList {
  id: UUID!
  name: String!
  colorHex: String!
  iconName: String!
  sortOrder: Int!
  isDefault: Boolean!
  reminderCount: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
}

input CreateReminderListInput {
  name: String!
  colorHex: String
  iconName: String
}

input UpdateReminderListInput {
  name: String
  colorHex: String
  iconName: String
  sortOrder: Int
}

# Connection types for lists
type ReminderListConnection {
  edges: [ReminderListEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type ReminderListEdge {
  node: ReminderList!
  cursor: String!
}

# Reminder types
enum Priority {
  NONE
  LOW
  NORMAL
  HIGH
}

enum ReminderStatus {
  ACTIVE
  COMPLETED
  SNOOZED
  DISMISSED
}

enum Frequency {
  HOURLY
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

type RecurrenceRule {
  frequency: Frequency!
  interval: Int!
  daysOfWeek: [Int!]
  dayOfMonth: Int
  monthOfYear: Int
  endAfterOccurrences: Int
  endDate: DateTime
}

input RecurrenceRuleInput {
  frequency: Frequency!
  interval: Int!
  daysOfWeek: [Int!]
  dayOfMonth: Int
  monthOfYear: Int
  endAfterOccurrences: Int
  endDate: DateTime
}

type Reminder {
  id: UUID!
  listId: UUID
  list: ReminderList
  title: String!
  notes: String
  priority: Priority!
  dueAt: DateTime
  allDay: Boolean
  recurrenceRule: RecurrenceRule
  recurrenceEnd: DateTime
  status: ReminderStatus!
  completedAt: DateTime
  snoozedUntil: DateTime
  snoozeCount: Int!
  isAlarm: Boolean!
  soundId: String
  tags: [String!]!
  localId: String
  version: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
}

# Input types
input CreateReminderInput {
  listId: UUID
  title: String!
  notes: String
  priority: Priority
  dueAt: DateTime
  allDay: Boolean
  recurrenceRule: RecurrenceRuleInput
  recurrenceEnd: DateTime
  isAlarm: Boolean
  soundId: String
  tags: [String!]
  localId: String
}

input UpdateReminderInput {
  listId: UUID
  title: String
  notes: String
  priority: Priority
  dueAt: DateTime
  allDay: Boolean
  recurrenceRule: RecurrenceRuleInput
  recurrenceEnd: DateTime
  isAlarm: Boolean
  soundId: String
  status: ReminderStatus
  tags: [String!]
}

input ReminderFilter {
  listId: UUID
  status: ReminderStatus
  fromDate: DateTime
  toDate: DateTime
  priority: Priority
  tags: [String!]
}

# Connection types for pagination
type ReminderConnection {
  edges: [ReminderEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type ReminderEdge {
  node: Reminder!
  cursor: String!
}

# Subscription types
enum ChangeAction {
  CREATED
  UPDATED
  DELETED
}

type ReminderChangeEvent {
  action: ChangeAction!
  reminder: Reminder
  reminderId: UUID!
  timestamp: DateTime!
}

type ReminderListChangeEvent {
  action: ChangeAction!
  reminderList: ReminderList
  reminderListId: UUID!
  timestamp: DateTime!
}

# Root types
type Query {
  me: User!
  reminder(id: UUID!): Reminder
  reminders(filter: ReminderFilter, pagination: PaginationInput): ReminderConnection!
  reminderList(id: UUID!): ReminderList
  reminderLists: [ReminderList!]!
  devices: [Device!]!
  notificationSounds: [NotificationSound!]!
}

type Mutation {
  # Authentication
  authenticateWithGoogle(idToken: String!): AuthPayload!
  refreshToken(refreshToken: String!): AuthPayload!
  logout: Boolean!

  # Subscription
  verifySubscription: User!

  # Reminder Lists
  createReminderList(input: CreateReminderListInput!): ReminderList!
  updateReminderList(id: UUID!, input: UpdateReminderListInput!): ReminderList!
  deleteReminderList(id: UUID!): Boolean!
  reorderReminderLists(ids: [UUID!]!): [ReminderList!]!

  # Reminders
  createReminder(input: CreateReminderInput!): Reminder!
  updateReminder(id: UUID!, input: UpdateReminderInput!): Reminder!
  deleteReminder(id: UUID!): Boolean!
  snoozeReminder(id: UUID!, minutes: Int!): Reminder!
  completeReminder(id: UUID!): Reminder!
  dismissReminder(id: UUID!): Boolean!
  moveReminderToList(reminderId: UUID!, listId: UUID!): Reminder!

  # Devices
  registerDevice(input: RegisterDeviceInput!): Device!
  unregisterDevice(id: UUID!): Boolean!
}

type Subscription {
  reminderChanged: ReminderChangeEvent!
  reminderListChanged: ReminderListChangeEvent!
}
